define(["ui/controls","ui/bar"],function(e,K){return smSeekBar=function(e){var r=e;r.registerObserver(this);var n,s,a,i,p=null,l=0,o=0,c=!1,d=0,m=!0,h=!1,u=!1,y=!1,v=null,f=0,g=0,b=10,E=!1,x=160,_=90,I=0,C=null,w="",k=!1,L="",O=0,T=[],t=0;(p=scenappsm._elements.createElement("div",r.getCssReform("player-progress-container"),"")).style.cursor="pointer",p.addEventListener(scenappsm.eventOver,V),p.addEventListener(scenappsm.eventOut,function(e){X()}),p.style.backgroundImage="linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.5))";var S=scenappsm._elements.createElement("div",r.getCssReform("player-progress-control player-progress-bar"),"player-progressbar");S.tabIndex=0,S.ariaLabel=ScenappsmAccessbility.progressbar,S.style.pointerEvents="none",S.setAttribute("role","slider"),S.setAttribute("draggable",!0),S.setAttribute("aria-valuemin",0),S.setAttribute("aria-valuenow",0),p.appendChild(S);var M=scenappsm._elements.createElement("div",r.getCssReform("slider-rail"),"");S.appendChild(M);var A=scenappsm._elements.createElement("div",r.getCssReform("slider-bar"));S.appendChild(A);var D=scenappsm._elements.createElement("div",r.getCssReform("slider-rail"),"");D.style.width=G(0,o),A.appendChild(D);var R=scenappsm._elements.createElement("div",r.getCssReform("download-progress"));R.style.opacity=.3,A.appendChild(R);var P=scenappsm._elements.createElement("div",r.getCssReform("slider-progress"));A.appendChild(P);var W=document.createElement("span");function N(e){if(0!=h)switch("pointer"!=p.style.cursor&&(p.style.cursor="pointer",p.addEventListener(scenappsm.eventOver,V)),e.type){case scenappsm.eventDown:if(0==m)return void(_controller&&_controller.excute(scenappsmPlayerCommand.ALERT_MESSAGE,scenappsmAlert.AVAILABLE_NOT_SEEK));c=!0;case scenappsm.eventMove:if(n="touchmove"==e.type||"touchstart"==e.type?event.touches[0].pageX:e.clientX,g=r.getCorrectSize(p,"width"),d=Number(Math.min(1,Math.max(0,(n-H(p).x)/g)).toFixed(5)),E?(D.style.width=G(d*o,o),O=d,r.notifyObserver(scenappsmEvent.MOUSE_POSITION,d)):0!=O&&(O=0,r.notifyObserver(scenappsmEvent.MOUSE_POSITION,O)),function(){if(f=Number(v.offsetWidth/2),0!=g&&0!=f){b=5,C&&(_sheetHalf=Number(C.offsetWidth/2),C.style.left=Math.min(g-C.offsetWidth-b,Math.max(b,n-_sheetHalf-H(p).x))+"px",_sheetX=parseInt(d*o/s),I!=parseInt(_sheetX/a)&&(C.style.backgroundImage="url('"+w+parseInt(_sheetX/a)+".jpg')"),I=parseInt(_sheetX/a),_sheetY=parseInt(_sheetX/10)-I*parseInt(a/10),C.style.backgroundPosition="-"+x*_sheetX+"px -"+_*_sheetY+"px",b=_sheetHalf-f),v.style.left=Math.min(g-v.offsetWidth-b,Math.max(b,n-f-H(p).x))+"px",v.innerHTML=y?"- "+scenappsm.intToTime(o-d*o):scenappsm.intToTime(d*o);var e=Number(W.offsetWidth/2);if(W.style.left=Math.min(g-W.offsetWidth-5,Math.max(5,n-e-H(p).x))+"px",i)for(var t=0;t<i.length;t++)if(i[t][0]<=d*o&&d*o<=i[t][2]){W.innerHTML=i[t][1];break}}}(),1==c){l=d=Number((d*o).toFixed(5));for(var t=0;t<T.length;t++)T[t].setSeekTime(d);j()}break;case scenappsm.eventUp:if(1==c){for(_controller&&_controller.excute(scenappsmPlayerCommand.SEEK,d),c=!1,t=0;t<T.length;t++)T[t].isSeek(c);"touchend"==e.type&&X()}}}function V(e){if(0==o)return p.style.cursor="",void p.removeEventListener(scenappsm.eventOver,V);e.target!=C&&e.target!=v&&(E=!0,S.style.height="6px",S.style.top="9px",W.style.display="block",v&&(v.style.display="block"),C&&(C.style.display="block",C.style.opacity=1))}function X(){c||(E=!1,S.style.height="",S.style.top="",W.style.display="none",v&&(v.style.display="none"),C&&(C.style.opacity=0),D.style.width=G(0,o))}function H(e){for(var t=0,n=0;e;)t+=e.offsetLeft-e.scrollLeft+e.clientLeft,n+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent;return{x:t,y:n}}function U(e){C.style.display=0==C.style.opacity?"none":"block"}function z(){if(null!=i)for(var e=0,t=0,n=0,s=0;s<T.length;s++)0!=i.length&&(e=(i[s][2]-n)/o*100,n=i[s][2]),99<=e||0==s?T[s].left(t):(T[s].left(T[s-1].getWidth()),t=T[s-1].getWidth()),0!=g&&T[s].setWidth(g)}function Y(){if(!(T.length<=0)){for(var e=0;e<T.length;e++)p.removeChild(T[e].getContainer());T=[]}}function B(e){if("number"==typeof e)return e;var t=e.split(":"),e=0;return 2==t.length?e=60*parseInt(t[0])+parseInt(t[t.length-1]):3==t.length&&(e=60*parseInt(t[0])*60+60*parseInt(t[1])+parseInt(t[t.length-1])),e}function j(){P.style.width=G(l,o),S.setAttribute("aria-valuemax",o),S.setAttribute("aria-valuenow",parseInt(l)),S.setAttribute("aria-valuetext",F(l)+"/"+F(o)),g=r.getCorrectSize(p,"width"),t!=g&&z(),t=g}function F(e){var t=scenappsm.intToTime(e).split(":"),n="";switch(t.length){case 2:n=parseInt(t[0])+"분 "+t[1]+"초";break;case 3:n=parseInt(t[0])+"시 "+parseInt(t[1])+"분 "+t[2]+"초"}return n}function G(e,t){return Math.min(100,Math.max(0,100*(0==t?0:e/t)))+"%"}W.style.color="#fff",W.style.position="absolute",W.style.width="auto",W.style.whiteSpace="nowrap",W.style.textAlign="center",W.style.textShadow="0px 0px 3px rgb(0,0,0)",W.style.display="none",W.style.bottom="20px",p.appendChild(W),scenappsm.addEventListener(window,scenappsm.eventOut,N),scenappsm.addEventListener(window,scenappsm.eventMove,N),scenappsm.addEventListener(window,scenappsm.eventUp,N),this.setChapter=function(e){Y(),i=[],W.innerHTML="",C&&(C.style.bottom="20px"),v&&(v.style.bottom="22px"),k=!1,L=e},this.setThumbnailSheet=function(e){""!=e&&null!=e?(e=(w=e).match(/(\_)(\d+)/g),x=parseInt(e[0].replace("_","")),_=parseInt(e[1].replace("_","")),s=parseInt(e[2].replace("_","")),a=parseInt(e[3].replace("_","")),null==C&&((C=document.createElement("img")).style.backgroundColor="black",C.style.position="absolute",C.style.bottom="20px",C.style.display="none",C.style.backgroundPosition="0 0",C.style.webkitTransition="opacity .1s",C.style.zIndex=5,C.style.transition="opacity .1s",p.appendChild(C),C.addEventListener("transitionend",U)),C.style.backgroundImage="url('"+w+"')",C.style.width=x+"px",C.style.height=_+"px",w=w.replace("0.jpg","")):C&&(p.removeChild(C),C.removeEventListener("transitionend",U),C=null)},this.setController=function(e){_controller=e},this.getContainer=function(){return p},this.update=function(e,t){switch(e){case scenappsmEvent.VIDEO_READY:y=t.isDVR,v||((v=document.createElement("div")).style.bottom="22px",v.style.width="auto",v.style.fontSize="12px",v.style.position="absolute",v.style.display="none",v.style.backgroundColor="rgba(28,28,28,0.5)",v.style.padding="2px 3px",v.style.zIndex=10,p.appendChild(v)),"touchstart"==scenappsm.eventDown&&y&&scenappsm.removeEventListener(p,scenappsm.eventDown,N);break;case scenappsmEvent.RESIZE:g=t.playerWidth,z();break;case scenappsmEvent.VIDEO_TIME:if(1==c||1==u&&0==y)return;t.type==scenappsmConst.CURRENT_TIME?l=t.value:t.type==scenappsmConst.DURATION&&(o=t.value,k||function(l){k=!0,M.style.display="none",A.style.display="none";try{i=function(){for(var e=[],t=l.split("\n"),n=[],s=[],a=0;a<t.length;a++){var r=t[a].match(/^([0-9]?[0-9]):([0-9][0-9])?:?([0-9][0-9])/g);null!=r&&(n[n.length]=r[0],s[s.length]=t[a].replace(/^([0-9]?[0-9]):([0-9][0-9])?:?([0-9][0-9])/g,"").replace(/\n|\r/g,""))}if(n.length<2)return e;for(a=0;a<n.length;a++){var i=[];i[0]=B(n[a]),i[1]=s[a],i[2]=a+1==n.length?o:B(n[a+1]),e[a]=i}return e}();var e,t=0,n=0;if(!(1<i.length))throw"list check";for(var s=0;s<i.length;s++){if(0!=i[0][0]||i[s][0]>=i[s][2])throw"list check";var a=new K(r);T[s]=a,p.appendChild(a.getContainer()),e=(i[s][2]-n)/o*100,n=i[s][2],99<=e||0==s?a.left(t):(a.left(T[s-1].getWidth()),t=T[s-1].getWidth()),a.setData({start:i[s][0],end:i[s][2],width:g,duration:o,isChapter:!0})}C&&(C.style.bottom="40px"),v&&(v.style.bottom="42px")}catch(l){Y(),a=new K(r),p.appendChild(a.getContainer()),a.setData({start:0,end:o,width:g,duration:o,isChapter:!1}),T[T.length]=a}}(L)),j();break;case scenappsmEvent.VIDEO_PROGRESS:if(1==u)return;R.style.width=t+"%";break;case scenappsmEvent.VIDEO_STOP:case scenappsmEvent.ALL_COMPLETE:case scenappsmEvent.VIDEO_COMPLETE:h=!1,l=0,j();break;case scenappsmEvent.VIDEO_PLAY:h=!0;break;case scenappsmEvent.VIDEO_STREAM:1==(u=t.isLive)&&0==y&&scenappsm.removeEventListener(p,scenappsm.eventDown,N)}},this.enabled=function(e){m=e},scenappsm.addEventListener(p,scenappsm.eventDown,N),j()},smSeekBar});