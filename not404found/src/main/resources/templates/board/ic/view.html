<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>인테리어 챌린지</title>
    <link rel="stylesheet" href="/css/board/all.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<header th:replace="common/header.html"></header>




<!-- ====================== 게시판 전체 태그 ====================== -->
<div class="board_wrap">
  <div class="board_title" style="margin-bottom: 30px;">
    <strong>인테리어 챌린지</strong>
  </div>
  <div class="board_view_wrap">
    <div class="board_view">
      <div class="title">
        <p th:text="${ icView.post_title }">
      </div>
      <input type="hidden" id="ic_post_code" name="post_code" th:value="${ icView.post_code }">
      <div class="info">
        <dl>
            <dt>글쓴이</dt>
            <dd id="ic_writer" th:text="${icView.account.id}"></dd>
        </dl>
        <dl>
          <dt>작성일</dt>
          <dd th:text="${icView.post_modified_date != null} ? ${icView.post_modified_date} : ${icView.post_created_date}"></dd>
        </dl>
        <dl>
          <dt>조회</dt>
          <dd th:text="${icView.post_views}"></dd>
        </dl>
      </div>

      <div class="img-box">
        <img id="ic_thumbnail" th:src="@{|/thumbPath${icView.attachmentList[0].getThumbnail_path()}|}" style="display: none;">
      </div>

      <div th:utext="${icView.post_content}" class="cont"></div>
    </div>

    <div class="ic_recommend">
      <input type="hidden" id="like_check" th:value="${icView.recommend_ic != null && icView.recommend_ic.r_check != null ? icView.recommend_ic.r_check : 0}">
      <img class="rounded-circle likeimg" id="likeimg" src="/images/board/before_recommend.png"
           width="60px" height="60px">
      <label>추천</label>
      <span id="recommend_count" th:text="${icView.recommend_count != null ? icView.recommend_count : 0}"></span>
    </div>

    <div class="bt_wrap">
      <button type="button" th:onclick="'location.href=\'/board/ic/list\''" class="writeBoard">목록</button>
      <th:block sec:authorize="isAuthenticated()"
                th:if="${ #authentication.getPrincipal().getUsername() == icView.account.id }">
        <button
                class="writeBoard"
                th:onclick="'location.href=\'/board/ic/modify?post_code='+ @{${ icView.post_code }} + '\''"
        >
          수정
        </button>
        <button
                class="writeBoard"
                th:onclick="'location.href=\'/board/ic/delete?post_code='+ @{${ icView.post_code }} + '\''"
        >
          삭제
        </button>
      </th:block>
    </div>



  </div>
</div>

<script>
  $(document).ready(async function () {
    // 페이지 로드 시 r_check 값을 가져와서 이미지 소스 변경
    const like_check = document.getElementById('like_check').value;
    console.log(like_check);
    const likeimg = document.getElementById("likeimg");
    const post_code = document.getElementById('ic_post_code').value;
    const recommend_count = document.getElementById('recommend_count');
    console.log(recommend_count);

    if (like_check === '1') {
      likeimg.setAttribute("src", "/images/board/after_recommend.png");
    } else {
      likeimg.setAttribute("src", "/images/board/before_recommend.png");
    }

    $(".likeimg").on("click", function () {

      go('/board/ic/recommend', post_code).then(data => {
        console.log(data);

        // 추천 수를 가져와서 증가 또는 감소
        const currentCount = parseInt(recommend_count.textContent, 10);
        const updatedCount = data == 1 ? currentCount + 1 : currentCount - 1;

        if (data == 1) {
          likeimg.setAttribute("src", "/images/board/after_recommend.png");
        } else {
          likeimg.setAttribute("src", "/images/board/before_recommend.png");
        }

        // 추천 수 업데이트
        recommend_count.textContent = updatedCount;
      });
    });


  });

</script>

</body>
</html>